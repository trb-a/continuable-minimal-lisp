/*!
  ContinuableMinimalLisp.js v0.4.3
  https://github.com/trb-a/continuable-minimal-lisp
  Released under the MIT License.
*/
import n from"tslib";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function t(n,e,r){return n(r={path:e,exports:{},require:function(n,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}var a=["do",["def","new",["fn",["a","&","b"],[".","Reflect",["`","construct"],"a","b"]]],["def","del",["fn",["a","b"],[".","Reflect",["`","deleteProperty"],"a","b"]]],["def","list",["fn",["&","a"],"a"]],["def",">=",["fn",["a","b"],["if",["<","a","b"],!1,!0]]],["def",">",["fn",["a","b"],["if",[">=","a","b"],["if",["=","a","b"],!1,!0],!1]]],["def","<=",["fn",["a","b"],["if",[">","a","b"],!1,!0]]],["def","classOf",["fn",["a"],[".",[".-",[".-","Object",["`","prototype"]],["`","toString"]],["`","call"],"a"]]],["def","not",["fn",["a"],["if","a",!1,!0]]],["def","null?",["fn",["a"],["=",null,"a"]]],["def","true?",["fn",["a"],["=",!0,"a"]]],["def","false?",["fn",["a"],["=",!1,"a"]]],["def","string?",["fn",["a"],["if",["=","a",null],!1,["=",["`","String"],[".-",[".-","a",["`","constructor"]],["`","name"]]]]]],["def","pr-str",["fn",["&","a"],[".",["map",[".-","JSON",["`","stringify"]],"a"],["`","join"],["`"," "]]]],["def","str",["fn",["&","a"],[".",["map",["fn",["x"],["if",["string?","x"],"x",[".","JSON",["`","stringify"],"x"]]],"a"],["`","join"],["`",""]]]],["def","prn",["fn",["&","a"],["do",[".","console",["`","log"],[".",["map",[".-","JSON",["`","stringify"]],"a"],["`","join"],["`"," "]]],null]]],["def","println",["fn",["&","a"],["do",[".","console",["`","log"],[".",["map",["fn",["x"],["if",["string?","x"],"x",[".","JSON",["`","stringify"],"x"]]],"a"],["`","join"],["`"," "]]],null]]],["def","list?",["fn",["a"],[".","Array",["`","isArray"],"a"]]],["def","contains?",["fn",["a","b"],[".","a",["`","hasOwnProperty"],"b"]]],["def","get",["fn",["a","b"],["if",["contains?","a","b"],[".-","a","b"],null]]],["def","set",["fn",["a","b","c"],["do",[".-","a","b","c"],"a"]]],["def","keys",["fn",["a"],[".","Object",["`","keys"],"a"]]],["def","vals",["fn",["a"],[".","Object",["`","values"],"a"]]],["def","cons",["fn",["a","b"],[".",["`",[]],["`","concat"],["list","a"],"b"]]],["def","concat",["fn",["&","a"],[".",[".-",["list"],["`","concat"]],["`","apply"],["list"],"a"]]],["def","nth","get"],["def","first",["fn",["a"],["if",[">",[".-","a",["`","length"]],0],["nth","a",0],null]]],["def","last",["fn",["a"],["nth","a",["-",[".-","a",["`","length"]],1]]]],["def","count",["fn",["a"],[".-","a",["`","length"]]]],["def","empty?",["fn",["a"],["if",["list?","a"],["=",0,[".-","a",["`","length"]]],["=","a",null]]]],["def","slice",["fn",["a","b","&","end"],[".","a",["`","slice"],"b",["if",[">",[".-","end",["`","length"]],0],["get","end",0],[".-","a",["`","length"]]]]]],["def","rest",["fn",["a"],["slice","a",1]]],["def","and",["~",["fn",["&","xs"],["if",["empty?","xs"],!0,["if",["=",1,[".-","xs",["`","length"]]],["first","xs"],["list",["`","let"],["list",["`","__and"],["first","xs"]],["list",["`","if"],["`","__and"],["concat",["`",["and"]],["rest","xs"]],["`","__and"]]]]]]]],["def","or",["~",["fn",["&","xs"],["if",["empty?","xs"],null,["if",["=",1,[".-","xs",["`","length"]]],["first","xs"],["list",["`","let"],["list",["`","__or"],["first","xs"]],["list",["`","if"],["`","__or"],["`","__or"],["concat",["`",["or"]],["rest","xs"]]]]]]]]],null],i=(t((function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TheGlobal=t.ContinuablePromise=t.EnvWrapper=t.Interpreter=t.findEnv=t.setEnv=t.newEnv=t.isContinuation=t.isApplicable=t.isHalfMacro=t.isMacro=t.isLambda=t.isEnv=t.isBOR=t.isPromiseLike=t.cloneAST=t.VERSION=t.LANGUAGE=void 0,t.LANGUAGE="Continuable-miniMAL-Lisp",t.VERSION="0.4.3",t.cloneAST=function(n,e){if(void 0===e&&(e=new Map),e.has(n))return e.get(n);if("object"==typeof n&&null!==n&&n.constructor===Object)return Object.keys(n).reduce((function(r,a){return r[a]=t.cloneAST(n[a],e),r}),{});if(n instanceof Array){var r=e.set(n,[]).get(n);return r.push.apply(r,n.map((function(n){return t.cloneAST(n,e)}))),r}return n};var i=function(n){throw n};t.isPromiseLike=function(n){return!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then};var o=function(n){return"string"==typeof n||i(n+" is not a symbol")},u=function(n){return"string"==typeof n||"symbol"==typeof n||"number"==typeof n||i("String(x) is not a property index")};t.isBOR=function(n,e){return"object"==typeof e&&null!==e&&"string"==typeof e.bor&&e.constructor===Object&&1===Object.keys(e).length&&e.bor in n};var l=function(n){return n instanceof Array},s=function(n){return l(n)||i(n+" is not an array")};t.isEnv=function(n){return n instanceof Array&&"object"==typeof n[0]&&null!==n[0]&&(n[1]instanceof Array||null===n[1])},t.isLambda=function(n){return n instanceof Array&&"=>"===n[0]&&4===n.length&&t.isEnv(n[3])&&n[1]instanceof Array&&n[1].every((function(n){return"string"==typeof n}))},t.isMacro=function(n){return n instanceof Array&&"~"===n[0]&&2===n.length&&t.isApplicable(n[1])},t.isHalfMacro=function(n){return n instanceof Array&&"~~"===n[0]&&2===n.length&&t.isApplicable(n[1])};var f=function(n){return"function"==typeof n};t.isApplicable=function(n){return t.isLambda(n)||f(n)||t.isContinuation(n)||t.isMacro(n)||t.isHalfMacro(n)};var c=function(n){return t.isApplicable(n)||i(n+" is not a applicable")},v=function(n){return t.isHalfMacro(n)||i(n+" is not a half macro")};t.isContinuation=function(n){return"object"==typeof n&&null!==n&&function(n){return"object"==typeof n&&null!==n&&n.parent instanceof Array&&"number"==typeof n.index&&t.isEnv(n.env)&&(null===n.flag||"string"==typeof n.flag)&&"object"==typeof n.handler}(n.current)&&n.stack instanceof Array&&"string"==typeof n.version&&n.version.replace(/\.[^.]+$/,"")===t.VERSION.replace(/\.[^.]+$/,"")};var d=function(n){return t.isContinuation(n)||i(n+" is not a continuation")},p=function(n){return n instanceof Array&&"try"===n[0]&&n[2]instanceof Array&&"string"==typeof n[2][1]&&n[2].length>=3||i(n+" is not a try form or malformed")};t.newEnv=function(n,e,r,t){void 0===t&&(t=!0);for(var a={},i=0;i<e.length;i++){if(t&&"&"===e[i]){a[""+e[i+1]]=r.slice(i);break}a[""+e[i]]=r[i]}return[a,n]},t.setEnv=function(n,e,r){return n[0][""+e]=r},t.findEnv=function(n,e,r){for(var t=n;t;t=t[1]){if(t[0].hasOwnProperty(r))return[t[0][r],!0,!1];if(!t[1]&&e&&r in e&&null!==e[r]&&("object"==typeof e[r]||"function"==typeof e[r]))return[{bor:r},!0,!0]}return[null,!1,!1]};var h=function(n){return n[1]?h(n[1]):n},y=function(e){var r,o=this;if(this.stackMax=1/0,this.base=x,this.env=[{},null],this.dynamicEnv=[{},null],this.loadCore=!0,this.debugCount=0,this.debugMode=!1,this.debugCore=!1,this.debugMax=1/0,this.debugFilter=function(){return!0},this.debug=function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];if(o.debugMode&&o.debugFilter(e)&&(r=r.map((function(n){return n instanceof Array?t.cloneAST(n):n})),console.log.apply(console,n.__spreadArrays([e],r)),o.debugCount++,o.debugCount>o.debugMax))throw new Error("too many debug message!")},this.evalAST=function(e,r,a){void 0===r&&(r=o.env),void 0===a&&(a=o.dynamicEnv);for(var u=[e],s=[{parent:u,index:0,env:r,dynamicEnv:a,flag:null,handler:null}],f=function(n){return s.length>=o.stackMax?i("Stack overflow"):(s.push(n),n)},c=function(){o.debug("Current eval-stack length, eval-stack: ",s.length,s);var e=s.pop(),r=e.parent,a=e.index,u=e.env,c=e.dynamicEnv,v=e.flag,d=e.handler,h=r[a];o.debug("Next evaluating AST node, env, dynamicEnv, flag: ",h,u,c,v);try{if("string"==typeof h){var y=t.findEnv(u,o.base,h),_=y[0],x=y[1];r[a]=x?_:i(h+" not found")}else if(l(h)){var O="string"==typeof h[0]?o.derefBOR(t.findEnv(u,o.base,h[0])[0]):null,j=(t.isMacro(O)?b:t.isHalfMacro(O)||t.isHalfMacro(o.derefBOR(h[0]))&&v?m:"string"==typeof h[0]&&A.hasOwnProperty(h[0])?A[h[0]]:t.isContinuation(h[0])||t.isContinuation(O)?E:g)({node:h,env:u,base:o.base,dynamicEnv:c,flag:v,handler:d,cont:{current:e,stack:s,lang:t.LANGUAGE,version:t.VERSION,info:null},interpreter:o}),S=j.ret,C=j.subevals,R=j.reevals;null==R||R.reverse().forEach((function(n){var e,t,i,o,l,s;return f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(t=n.index)&&void 0!==t?t:a,env:null!==(i=n.env)&&void 0!==i?i:u,dynamicEnv:null!==(o=n.dynamicEnv)&&void 0!==o?o:c,flag:null!==(l=n.flag)&&void 0!==l?l:null,handler:null!==(s=n.handler)&&void 0!==s?s:d})})),null==C||C.reverse().forEach((function(n){var e,t,i,o,l,s;return n&&f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(t=n.index)&&void 0!==t?t:a,env:null!==(i=n.env)&&void 0!==i?i:u,dynamicEnv:null!==(o=n.dynamicEnv)&&void 0!==o?o:c,flag:null!==(l=n.flag)&&void 0!==l?l:null,handler:null!==(s=n.handler)&&void 0!==s?s:d})})),r[a]=S}}catch(e){if(t.isContinuation(e))throw o.debug("Suspend. Continuation: ",e),e;if(e instanceof w)throw o.debug("Suspend. ContinuablePomise: ",e),e;if(o.debug("Caught an exception. Exception: ",e),!d)throw e;var M=d.parent[d.index];p(M);var N=M[2][1];t.setEnv(d.env,N,e),s.splice.apply(s,n.__spreadArrays([0,s.length],s.filter((function(n){return n.handler!==d})))),f(d)}finally{o.debug("Evaluation Done. Node, env, dynamicEnv: ",r[a],u,c)}};s.length;)c();return o.debug("Evaluatin finished. Result: ",u[0]),u[0]},this.eval=function(n){return o.evalAST(n)},this.rep=function(n){try{return JSON.stringify(o.eval(JSON.parse(n)))}catch(n){if(n instanceof TypeError&&n.message.match(/(circular|cyclic)/i))return;throw n}},this.resume=function(n,e){return o.evalAST(["resume",n,e])},this.evalInBase=function(n){o.evalAST(n,[o.base,null])},this.derefBOR=function(n){return t.isBOR(o.base,n)?o.base[n.bor]:n},this.wrapLambda=function(e){return t.isLambda(e)?function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return o.evalAST(n.__spreadArrays([["`",e]],r))}:e},this.evalAsync=function(n){return new Promise((function(e,r){var t=function(n){try{e(n instanceof w?n.resume():o.eval(n))}catch(n){n instanceof w?n.then((function(){return t(n)}),(function(n){return r(n)})):r(n)}};t(n)}))},"object"==typeof(r=e)&&null!==r&&Object.keys(r).filter((function(n){return void 0===r[n]})).forEach((function(n){return delete r[n]})),Object.assign(this,e),this.loadCore){var u=this.debugMode;this.debugMode=this.debugCore,this.evalInBase(a),this.debugMode=u}};t.Interpreter=y;var g=function(e){var r=e.node,a=e.env,i=e.dynamicEnv,o=e.base,u=e.flag,l=e.interpreter,s=l.derefBOR(r[0]);if(!u&&!t.isApplicable(s)){var c=n.__spreadArrays(r);return{ret:c,reevals:[{flag:"!"}],subevals:c.map((function(n,e){return{parent:c,index:e,env:a}}))}}var v=r.slice(1);if(f(s))try{return{ret:s.apply(void 0,v.map((function(n){return l.wrapLambda(l.derefBOR(n))})))}}catch(h){if(t.isContinuation(h))throw"Javascript function can not throw any continuation.";throw h}else{if(!t.isLambda(s))throw String(s)+" is not applicable";var d=s[1],p=s[2],h=s[3];if("function"!=typeof p)return{ret:p,reevals:[{env:t.newEnv(h,d,v)}]};try{return{ret:p(new _(t.newEnv(h,d,v),i,a,o),l)}}catch(h){if(t.isContinuation(h))throw"Javascript function can not throw any continuation.";throw h}}},b=function(e){var r=e.node,a=e.env,u=e.base,l=e.interpreter;o(r[0]);var s,f=l.derefBOR(t.findEnv(a,u,r[0])[0]);return s=f,t.isMacro(s)||i(s+" is not a macro"),{ret:n.__spreadArrays([f[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}},m=function(e){var r=e.node,a=e.env,i=e.base,u=e.flag,l=e.interpreter;if(u){s=l.derefBOR(r[0]);return v(s),{ret:n.__spreadArrays([s[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}}o(r[0]);var s=l.derefBOR(t.findEnv(a,i,r[0])[0]);v(s);var f=n.__spreadArrays(r);return{ret:f,subevals:f.map((function(n,e){return{parent:f,index:e}})),reevals:[{flag:"!"}]}},E=function(e){var r,a=e.node,i=e.flag,o=e.cont,u=a[0];if(i||t.isApplicable(u)){var l=a.slice(1);d(u);var s=u.current,f=s.parent;f[s.index]=null!==(r=l[0])&&void 0!==r?r:null;var c=u.stack.length>0?u.stack[0].parent:f;if(1!==c.length)throw"Illeal root of continuation";var v=u.stack.map((function(n){return n.parent===c&&(n.parent=o.current.parent,n.index=o.current.index),n}));return{ret:c[0],subevals:v.reverse()}}var p=n.__spreadArrays(a);return{ret:p,reevals:[{flag:"!"}],subevals:p.map((function(n,e){return{parent:p,index:e}}))}},A={"`":function(n){return{ret:n.node[1]}},eval:function(e){var r=e.node;if(e.flag)return{ret:r[1],reevals:[{flag:null}]};var t=n.__spreadArrays(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},def:function(e){var r=e.node,a=e.env;if(e.flag){var i=r[1],u=r[2],l=void 0===u?null:u;return o(i),{ret:t.setEnv(a,i,l)}}var s=n.__spreadArrays(r);return{ret:s,reevals:[{flag:"!"}],subevals:[{parent:s,index:2}]}},defdynamic:function(e){var r=e.node,a=e.dynamicEnv;if(e.flag){var i=r[1],u=r[2],l=void 0===u?null:u;return o(i),t.setEnv(h(a),i,l),{ret:l}}var s=n.__spreadArrays(r);return{ret:s,reevals:[{flag:"!"}],subevals:[{parent:s,index:2}]}},"~":function(e){var r=e.node,t=e.flag,a=n.__spreadArrays(r);return t?(c(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},"~~":function(e){var r=e.node,t=e.flag,a=n.__spreadArrays(r);return t?(c(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},".-":function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read/set property of null or undefined.";var o=r.map((function(n){return a.derefBOR(n)})),l=o[2],s=o[3];return u(l),{ret:3===r.length?i[l]:i[l]=s}}var f=n.__spreadArrays(r);return{ret:f,reevals:[{flag:"!"}],subevals:f.map((function(n,e){return e>=1&&{parent:f,index:e}}))}},".":function(e){var r=e.node,a=(e.base,e.flag),i=e.interpreter;if(!a){var o=n.__spreadArrays(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}}var l=i.derefBOR(r[1]);if(null==l)throw"Can't call method of null or undefined.";var s=r[2],f=r.slice(3);if(u(s),"function"!=typeof l[s])return c(l[s]),{ret:n.__spreadArrays([l[s]],f),reevals:[{flag:"!"}]};try{return{ret:l[s].apply(l,f.map((function(n){return i.wrapLambda(i.derefBOR(n))})))}}catch(n){if(t.isContinuation(n))throw"Javascript methods can not throw any continuation.";throw n}},oget:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read property of null or undefined.";var o=r[2];return u(o),{ret:i[o]}}var l=n.__spreadArrays(r);return{ret:l,reevals:[{flag:"!"}],subevals:l.map((function(n,e){return e>=1&&{parent:l,index:e}}))}},oset:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't set property of null or undefined.";var o=r[2],l=r[3];return u(o),{ret:i[o]=l}}var s=n.__spreadArrays(r);return{ret:s,reevals:[{flag:"!"}],subevals:s.map((function(n,e){return e>=1&&{parent:s,index:e}}))}},try:function(e){var r=e.node,a=e.env,i=e.dynamicEnv,o=e.flag,u=e.cont,l=e.handler;if(p(r),o){if("!"===o)return{ret:r[1]};if("!!"===o)return{ret:r[2][2],reevals:[{}]};throw"Illegal status for try-catch."}var s={parent:u.current.parent,index:u.current.index,env:t.newEnv(a,[],[]),dynamicEnv:i,flag:"!!",handler:l},f=n.__spreadArrays(r);return{ret:f,reevals:[{flag:"!",handler:s}],subevals:[{parent:f,index:1,handler:s}]}},fn:function(n){var e,r=n.node,t=n.env;return(e=r)instanceof Array&&"fn"===e[0]&&3===e.length&&e[1]instanceof Array&&e[1].every((function(n){return"string"==typeof n}))||i(e+" is not a fn form or malformed"),{ret:["=>",r[1],r[2],t]}},map:function(e){var r=e.node;if(e.flag){var t=r[1],a=r[2];s(a);var i=a.map((function(n,e){return[t,a[e]]}));return{ret:i,subevals:i.map((function(n,e){return{parent:i,index:e,flag:"!"}}))}}var o=n.__spreadArrays(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},apply:function(e){var r=e.node;if(e.flag){var t=r[1],a=r.slice(2),i=a.pop();return s(i),a.push.apply(a,i),{ret:n.__spreadArrays([t],a),reevals:[{flag:"!"}]}}var o=n.__spreadArrays(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},let:function(e){var r,a=e.node,o=e.env;(r=a)instanceof Array&&"let"===r[0]&&r[1]instanceof Array&&r.length>=3||i(r+" is not a let form or malformed");var u=a[1],l=a[2];u.length%2==1&&u.push(null);var s=u.reduce((function(n,e,r){return r%2?n:n.concat([[u[r],u[r+1]]])}),[]);return{ret:n.__spreadArrays(["do"],s.map((function(n){return["def",n[0],n[1]]})),[l]),reevals:[{env:t.newEnv(o,[],[])}]}},"dynamic-let":function(e){var r,a=e.node,o=e.dynamicEnv,u=e.flag;if((r=a)instanceof Array&&"dynamic-let"===r[0]&&r[1]instanceof Array&&r.length>=3||i(r+" is not a let form or malformed"),u){var l=a[1];d=a[2];l.length%2==1&&l.push(null);var s=l.reduce((function(n,e,r){return r%2?n:n.concat([[l[r],l[r+1]]])}),[]),f=t.newEnv(o,[],[]);return s.forEach((function(n){var e=n[0],r=n[1];return t.setEnv(f,String(e),r)})),{ret:d,reevals:[{dynamicEnv:f}]}}var c=a[0],v=a[1],d=a[2],p=n.__spreadArrays(v);return{ret:[c,p,d],subevals:p.map((function(n,e){return e})).filter((function(n){return n%2==1})).map((function(n){return{parent:p,index:n}})),reevals:[{flag:"!"}]}},do:function(n){var e=n.node.slice(1),r=e.slice(-1)[0];return{ret:void 0===r?null:r,reevals:[{flag:null}],subevals:e.slice(0,-1).map((function(n){return{parent:[n],index:0}}))}},if:function(e){var r=e.node;if(e.flag)return{ret:r[1]?r[2]:r[3],reevals:[{flag:null}]};var t=n.__spreadArrays(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},suspend:function(e){var r,t=e.node,a=e.flag,i=e.cont;if(a){var o=t.slice(1);throw i.info=null!==(r=o[0])&&void 0!==r?r:null,i}var u=n.__spreadArrays(t);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}},resume:function(e){var r=e.node,t=(e.flag,r[1]),a=r.slice(2);return d(t),{ret:n.__spreadArrays([t],a),reevals:[{flag:"!"}]}},dynamic:function(n){var e=n.node,r=n.dynamicEnv,a=e[1];o(a);var u=t.findEnv(r,null,a),l=u[0];return{ret:u[1]?l:i("dynamic variable "+a+" not found")}},await:function(e){var r=e.node,t=e.flag,a=e.cont,i=e.interpreter;if(t){var o=r.slice(1);throw new w(i,0===o.length?null:1===o.length?o[0]:Promise.all(o),a)}var u=n.__spreadArrays(r);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}}},_=function(n,e,r,a){var i=this;this.get=function(n){return t.findEnv(i.env,i.base,n)[0]},this.has=function(n){return t.findEnv(i.env,i.base,n)[1]},this.set=function(n,e){return t.setEnv(i.env,n,e)},this.dynamicGet=function(n){return t.findEnv(i.dynamicEnv,null,n)[0]},this.dynamicHas=function(n){return t.findEnv(i.dynamicEnv,null,n)[1]},this.dynamicSet=function(n,e){return t.setEnv(h(i.dynamicEnv),n,e)},this.dynamicSetLocal=function(n,e){return t.setEnv(i.dynamicEnv,n,e)},this.callerGet=function(n){return t.findEnv(i.callerEnv,i.base,n)[0]},this.callerHas=function(n){return t.findEnv(i.callerEnv,i.base,n)[1]},this.env=n,this.dynamicEnv=e,this.callerEnv=r,this.base=a};t.EnvWrapper=_;var w=function(){function n(n,e,r){var a=this;this.status="pending",this.promise=new Promise((function(n,e){a.resolve=n,a.reject=e})),this.interpreter=n,this.coninuation=r,t.isPromiseLike(e)?e.then((function(n){a.resolvedValue=n,a.status="fulfilled",a.resolve()}),(function(n){a.rejectedReason=n,a.status="rejected",a.reject(n)})):(this.resolvedValue=e,this.status="fulfilled",this.resolve())}return n.prototype.isFulfilled=function(){return"fulfilled"===this.status},n.prototype.isRejected=function(){return"rejected"===this.status},n.prototype.isPending=function(){return"pending"===this.status},n.prototype.reason=function(){if(!this.isRejected())throw new Error("The promise is not rejected yet.");return this.rejectedReason},n.prototype.resume=function(){if(!this.isFulfilled())throw new Error("The promise is not fulfilled yet.");return this.interpreter.resume(this.coninuation,this.resolvedValue)},n.prototype.then=function(n,e){return this.promise.then(n,e)},n.prototype.catch=function(n){return this.promise.catch(n)},n}();t.ContinuablePromise=w,t.TheGlobal=globalThis||window||e||e;var x=Object.assign(Object.create(t.TheGlobal),{"=":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]===n[1]},"<":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])<Number(n[1])},"+":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])+Number(n[1])},"-":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])-Number(n[1])},"*":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])*Number(n[1])},"/":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])/Number(n[1])},isa:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]instanceof n[1]},type:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return typeof n[0]},new:function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((n=e[0]).bind.apply(n,e))},del:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return delete n[0][n[1]]},throw:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];throw n[0]},read:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return JSON.parse(n[0])},js:eval});t.default=y})),t((function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TheGlobal=t.ContinuablePromise=t.EnvWrapper=t.Interpreter=t.findEnv=t.setEnv=t.newEnv=t.isContinuation=t.isApplicable=t.isHalfMacro=t.isMacro=t.isLambda=t.isEnv=t.isBOR=t.isPromiseLike=t.cloneAST=t.VERSION=t.LANGUAGE=void 0,t.LANGUAGE="Continuable-miniMAL-Lisp",t.VERSION="0.4.3",t.cloneAST=function(n,e){if(void 0===e&&(e=new Map),e.has(n))return e.get(n);if("object"==typeof n&&null!==n&&n.constructor===Object)return Object.keys(n).reduce((function(r,a){return r[a]=t.cloneAST(n[a],e),r}),{});if(n instanceof Array){var r=e.set(n,[]).get(n);return r.push.apply(r,n.map((function(n){return t.cloneAST(n,e)}))),r}return n};var i=function(n){throw n};t.isPromiseLike=function(n){return!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then};var o=function(n){return"string"==typeof n||i(n+" is not a symbol")},u=function(n){return"string"==typeof n||"symbol"==typeof n||"number"==typeof n||i("String(x) is not a property index")};t.isBOR=function(n,e){return"object"==typeof e&&null!==e&&"string"==typeof e.bor&&e.constructor===Object&&1===Object.keys(e).length&&e.bor in n};var l=function(n){return n instanceof Array},s=function(n){return l(n)||i(n+" is not an array")};t.isEnv=function(n){return n instanceof Array&&"object"==typeof n[0]&&null!==n[0]&&(n[1]instanceof Array||null===n[1])},t.isLambda=function(n){return n instanceof Array&&"=>"===n[0]&&4===n.length&&t.isEnv(n[3])&&n[1]instanceof Array&&n[1].every((function(n){return"string"==typeof n}))},t.isMacro=function(n){return n instanceof Array&&"~"===n[0]&&2===n.length&&t.isApplicable(n[1])},t.isHalfMacro=function(n){return n instanceof Array&&"~~"===n[0]&&2===n.length&&t.isApplicable(n[1])};var f=function(n){return"function"==typeof n};t.isApplicable=function(n){return t.isLambda(n)||f(n)||t.isContinuation(n)||t.isMacro(n)||t.isHalfMacro(n)};var c=function(n){return t.isApplicable(n)||i(n+" is not a applicable")},v=function(n){return t.isHalfMacro(n)||i(n+" is not a half macro")};t.isContinuation=function(n){return"object"==typeof n&&null!==n&&function(n){return"object"==typeof n&&null!==n&&n.parent instanceof Array&&"number"==typeof n.index&&t.isEnv(n.env)&&(null===n.flag||"string"==typeof n.flag)&&"object"==typeof n.handler}(n.current)&&n.stack instanceof Array&&"string"==typeof n.version&&n.version.replace(/\.[^.]+$/,"")===t.VERSION.replace(/\.[^.]+$/,"")};var d=function(n){return t.isContinuation(n)||i(n+" is not a continuation")},p=function(n){return n instanceof Array&&"try"===n[0]&&n[2]instanceof Array&&"string"==typeof n[2][1]&&n[2].length>=3||i(n+" is not a try form or malformed")};t.newEnv=function(n,e,r,t){void 0===t&&(t=!0);for(var a={},i=0;i<e.length;i++){if(t&&"&"===e[i]){a[""+e[i+1]]=r.slice(i);break}a[""+e[i]]=r[i]}return[a,n]},t.setEnv=function(n,e,r){return n[0][""+e]=r},t.findEnv=function(n,e,r){for(var t=n;t;t=t[1]){if(t[0].hasOwnProperty(r))return[t[0][r],!0,!1];if(!t[1]&&e&&r in e&&null!==e[r]&&("object"==typeof e[r]||"function"==typeof e[r]))return[{bor:r},!0,!0]}return[null,!1,!1]};var h=function(n){return n[1]?h(n[1]):n},y=function(e){var r,o=this;if(this.stackMax=1/0,this.base=x,this.env=[{},null],this.dynamicEnv=[{},null],this.loadCore=!0,this.debugCount=0,this.debugMode=!1,this.debugCore=!1,this.debugMax=1/0,this.debugFilter=function(){return!0},this.debug=function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];if(o.debugMode&&o.debugFilter(e)&&(r=r.map((function(n){return n instanceof Array?t.cloneAST(n):n})),console.log.apply(console,n.__spreadArrays([e],r)),o.debugCount++,o.debugCount>o.debugMax))throw new Error("too many debug message!")},this.evalAST=function(e,r,a){void 0===r&&(r=o.env),void 0===a&&(a=o.dynamicEnv);for(var u=[e],s=[{parent:u,index:0,env:r,dynamicEnv:a,flag:null,handler:null}],f=function(n){return s.length>=o.stackMax?i("Stack overflow"):(s.push(n),n)},c=function(){o.debug("Current eval-stack length, eval-stack: ",s.length,s);var e=s.pop(),r=e.parent,a=e.index,u=e.env,c=e.dynamicEnv,v=e.flag,d=e.handler,h=r[a];o.debug("Next evaluating AST node, env, dynamicEnv, flag: ",h,u,c,v);try{if("string"==typeof h){var y=t.findEnv(u,o.base,h),_=y[0],x=y[1];r[a]=x?_:i(h+" not found")}else if(l(h)){var O="string"==typeof h[0]?o.derefBOR(t.findEnv(u,o.base,h[0])[0]):null,j=(t.isMacro(O)?b:t.isHalfMacro(O)||t.isHalfMacro(o.derefBOR(h[0]))&&v?m:"string"==typeof h[0]&&A.hasOwnProperty(h[0])?A[h[0]]:t.isContinuation(h[0])||t.isContinuation(O)?E:g)({node:h,env:u,base:o.base,dynamicEnv:c,flag:v,handler:d,cont:{current:e,stack:s,lang:t.LANGUAGE,version:t.VERSION,info:null},interpreter:o}),S=j.ret,C=j.subevals,R=j.reevals;null==R||R.reverse().forEach((function(n){var e,t,i,o,l,s;return f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(t=n.index)&&void 0!==t?t:a,env:null!==(i=n.env)&&void 0!==i?i:u,dynamicEnv:null!==(o=n.dynamicEnv)&&void 0!==o?o:c,flag:null!==(l=n.flag)&&void 0!==l?l:null,handler:null!==(s=n.handler)&&void 0!==s?s:d})})),null==C||C.reverse().forEach((function(n){var e,t,i,o,l,s;return n&&f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(t=n.index)&&void 0!==t?t:a,env:null!==(i=n.env)&&void 0!==i?i:u,dynamicEnv:null!==(o=n.dynamicEnv)&&void 0!==o?o:c,flag:null!==(l=n.flag)&&void 0!==l?l:null,handler:null!==(s=n.handler)&&void 0!==s?s:d})})),r[a]=S}}catch(e){if(t.isContinuation(e))throw o.debug("Suspend. Continuation: ",e),e;if(e instanceof w)throw o.debug("Suspend. ContinuablePomise: ",e),e;if(o.debug("Caught an exception. Exception: ",e),!d)throw e;var M=d.parent[d.index];p(M);var N=M[2][1];t.setEnv(d.env,N,e),s.splice.apply(s,n.__spreadArrays([0,s.length],s.filter((function(n){return n.handler!==d})))),f(d)}finally{o.debug("Evaluation Done. Node, env, dynamicEnv: ",r[a],u,c)}};s.length;)c();return o.debug("Evaluatin finished. Result: ",u[0]),u[0]},this.eval=function(n){return o.evalAST(n)},this.rep=function(n){try{return JSON.stringify(o.eval(JSON.parse(n)))}catch(n){if(n instanceof TypeError&&n.message.match(/(circular|cyclic)/i))return;throw n}},this.resume=function(n,e){return o.evalAST(["resume",n,e])},this.evalInBase=function(n){o.evalAST(n,[o.base,null])},this.derefBOR=function(n){return t.isBOR(o.base,n)?o.base[n.bor]:n},this.wrapLambda=function(e){return t.isLambda(e)?function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return o.evalAST(n.__spreadArrays([["`",e]],r))}:e},this.evalAsync=function(n){return new Promise((function(e,r){var t=function(n){try{e(n instanceof w?n.resume():o.eval(n))}catch(n){n instanceof w?n.then((function(){return t(n)}),(function(n){return r(n)})):r(n)}};t(n)}))},"object"==typeof(r=e)&&null!==r&&Object.keys(r).filter((function(n){return void 0===r[n]})).forEach((function(n){return delete r[n]})),Object.assign(this,e),this.loadCore){var u=this.debugMode;this.debugMode=this.debugCore,this.evalInBase(a),this.debugMode=u}};t.Interpreter=y;var g=function(e){var r=e.node,a=e.env,i=e.dynamicEnv,o=e.base,u=e.flag,l=e.interpreter,s=l.derefBOR(r[0]);if(!u&&!t.isApplicable(s)){var c=n.__spreadArrays(r);return{ret:c,reevals:[{flag:"!"}],subevals:c.map((function(n,e){return{parent:c,index:e,env:a}}))}}var v=r.slice(1);if(f(s))try{return{ret:s.apply(void 0,v.map((function(n){return l.wrapLambda(l.derefBOR(n))})))}}catch(h){if(t.isContinuation(h))throw"Javascript function can not throw any continuation.";throw h}else{if(!t.isLambda(s))throw String(s)+" is not applicable";var d=s[1],p=s[2],h=s[3];if("function"!=typeof p)return{ret:p,reevals:[{env:t.newEnv(h,d,v)}]};try{return{ret:p(new _(t.newEnv(h,d,v),i,a,o),l)}}catch(h){if(t.isContinuation(h))throw"Javascript function can not throw any continuation.";throw h}}},b=function(e){var r=e.node,a=e.env,u=e.base,l=e.interpreter;o(r[0]);var s,f=l.derefBOR(t.findEnv(a,u,r[0])[0]);return s=f,t.isMacro(s)||i(s+" is not a macro"),{ret:n.__spreadArrays([f[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}},m=function(e){var r=e.node,a=e.env,i=e.base,u=e.flag,l=e.interpreter;if(u){s=l.derefBOR(r[0]);return v(s),{ret:n.__spreadArrays([s[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}}o(r[0]);var s=l.derefBOR(t.findEnv(a,i,r[0])[0]);v(s);var f=n.__spreadArrays(r);return{ret:f,subevals:f.map((function(n,e){return{parent:f,index:e}})),reevals:[{flag:"!"}]}},E=function(e){var r,a=e.node,i=e.flag,o=e.cont,u=a[0];if(i||t.isApplicable(u)){var l=a.slice(1);d(u);var s=u.current,f=s.parent;f[s.index]=null!==(r=l[0])&&void 0!==r?r:null;var c=u.stack.length>0?u.stack[0].parent:f;if(1!==c.length)throw"Illeal root of continuation";var v=u.stack.map((function(n){return n.parent===c&&(n.parent=o.current.parent,n.index=o.current.index),n}));return{ret:c[0],subevals:v.reverse()}}var p=n.__spreadArrays(a);return{ret:p,reevals:[{flag:"!"}],subevals:p.map((function(n,e){return{parent:p,index:e}}))}},A={"`":function(n){return{ret:n.node[1]}},eval:function(e){var r=e.node;if(e.flag)return{ret:r[1],reevals:[{flag:null}]};var t=n.__spreadArrays(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},def:function(e){var r=e.node,a=e.env;if(e.flag){var i=r[1],u=r[2],l=void 0===u?null:u;return o(i),{ret:t.setEnv(a,i,l)}}var s=n.__spreadArrays(r);return{ret:s,reevals:[{flag:"!"}],subevals:[{parent:s,index:2}]}},defdynamic:function(e){var r=e.node,a=e.dynamicEnv;if(e.flag){var i=r[1],u=r[2],l=void 0===u?null:u;return o(i),t.setEnv(h(a),i,l),{ret:l}}var s=n.__spreadArrays(r);return{ret:s,reevals:[{flag:"!"}],subevals:[{parent:s,index:2}]}},"~":function(e){var r=e.node,t=e.flag,a=n.__spreadArrays(r);return t?(c(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},"~~":function(e){var r=e.node,t=e.flag,a=n.__spreadArrays(r);return t?(c(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},".-":function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read/set property of null or undefined.";var o=r.map((function(n){return a.derefBOR(n)})),l=o[2],s=o[3];return u(l),{ret:3===r.length?i[l]:i[l]=s}}var f=n.__spreadArrays(r);return{ret:f,reevals:[{flag:"!"}],subevals:f.map((function(n,e){return e>=1&&{parent:f,index:e}}))}},".":function(e){var r=e.node,a=(e.base,e.flag),i=e.interpreter;if(!a){var o=n.__spreadArrays(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}}var l=i.derefBOR(r[1]);if(null==l)throw"Can't call method of null or undefined.";var s=r[2],f=r.slice(3);if(u(s),"function"!=typeof l[s])return c(l[s]),{ret:n.__spreadArrays([l[s]],f),reevals:[{flag:"!"}]};try{return{ret:l[s].apply(l,f.map((function(n){return i.wrapLambda(i.derefBOR(n))})))}}catch(n){if(t.isContinuation(n))throw"Javascript methods can not throw any continuation.";throw n}},oget:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read property of null or undefined.";var o=r[2];return u(o),{ret:i[o]}}var l=n.__spreadArrays(r);return{ret:l,reevals:[{flag:"!"}],subevals:l.map((function(n,e){return e>=1&&{parent:l,index:e}}))}},oset:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't set property of null or undefined.";var o=r[2],l=r[3];return u(o),{ret:i[o]=l}}var s=n.__spreadArrays(r);return{ret:s,reevals:[{flag:"!"}],subevals:s.map((function(n,e){return e>=1&&{parent:s,index:e}}))}},try:function(e){var r=e.node,a=e.env,i=e.dynamicEnv,o=e.flag,u=e.cont,l=e.handler;if(p(r),o){if("!"===o)return{ret:r[1]};if("!!"===o)return{ret:r[2][2],reevals:[{}]};throw"Illegal status for try-catch."}var s={parent:u.current.parent,index:u.current.index,env:t.newEnv(a,[],[]),dynamicEnv:i,flag:"!!",handler:l},f=n.__spreadArrays(r);return{ret:f,reevals:[{flag:"!",handler:s}],subevals:[{parent:f,index:1,handler:s}]}},fn:function(n){var e,r=n.node,t=n.env;return(e=r)instanceof Array&&"fn"===e[0]&&3===e.length&&e[1]instanceof Array&&e[1].every((function(n){return"string"==typeof n}))||i(e+" is not a fn form or malformed"),{ret:["=>",r[1],r[2],t]}},map:function(e){var r=e.node;if(e.flag){var t=r[1],a=r[2];s(a);var i=a.map((function(n,e){return[t,a[e]]}));return{ret:i,subevals:i.map((function(n,e){return{parent:i,index:e,flag:"!"}}))}}var o=n.__spreadArrays(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},apply:function(e){var r=e.node;if(e.flag){var t=r[1],a=r.slice(2),i=a.pop();return s(i),a.push.apply(a,i),{ret:n.__spreadArrays([t],a),reevals:[{flag:"!"}]}}var o=n.__spreadArrays(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},let:function(e){var r,a=e.node,o=e.env;(r=a)instanceof Array&&"let"===r[0]&&r[1]instanceof Array&&r.length>=3||i(r+" is not a let form or malformed");var u=a[1],l=a[2];u.length%2==1&&u.push(null);var s=u.reduce((function(n,e,r){return r%2?n:n.concat([[u[r],u[r+1]]])}),[]);return{ret:n.__spreadArrays(["do"],s.map((function(n){return["def",n[0],n[1]]})),[l]),reevals:[{env:t.newEnv(o,[],[])}]}},"dynamic-let":function(e){var r,a=e.node,o=e.dynamicEnv,u=e.flag;if((r=a)instanceof Array&&"dynamic-let"===r[0]&&r[1]instanceof Array&&r.length>=3||i(r+" is not a let form or malformed"),u){var l=a[1];d=a[2];l.length%2==1&&l.push(null);var s=l.reduce((function(n,e,r){return r%2?n:n.concat([[l[r],l[r+1]]])}),[]),f=t.newEnv(o,[],[]);return s.forEach((function(n){var e=n[0],r=n[1];return t.setEnv(f,String(e),r)})),{ret:d,reevals:[{dynamicEnv:f}]}}var c=a[0],v=a[1],d=a[2],p=n.__spreadArrays(v);return{ret:[c,p,d],subevals:p.map((function(n,e){return e})).filter((function(n){return n%2==1})).map((function(n){return{parent:p,index:n}})),reevals:[{flag:"!"}]}},do:function(n){var e=n.node.slice(1),r=e.slice(-1)[0];return{ret:void 0===r?null:r,reevals:[{flag:null}],subevals:e.slice(0,-1).map((function(n){return{parent:[n],index:0}}))}},if:function(e){var r=e.node;if(e.flag)return{ret:r[1]?r[2]:r[3],reevals:[{flag:null}]};var t=n.__spreadArrays(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},suspend:function(e){var r,t=e.node,a=e.flag,i=e.cont;if(a){var o=t.slice(1);throw i.info=null!==(r=o[0])&&void 0!==r?r:null,i}var u=n.__spreadArrays(t);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}},resume:function(e){var r=e.node,t=(e.flag,r[1]),a=r.slice(2);return d(t),{ret:n.__spreadArrays([t],a),reevals:[{flag:"!"}]}},dynamic:function(n){var e=n.node,r=n.dynamicEnv,a=e[1];o(a);var u=t.findEnv(r,null,a),l=u[0];return{ret:u[1]?l:i("dynamic variable "+a+" not found")}},await:function(e){var r=e.node,t=e.flag,a=e.cont,i=e.interpreter;if(t){var o=r.slice(1);throw new w(i,0===o.length?null:1===o.length?o[0]:Promise.all(o),a)}var u=n.__spreadArrays(r);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}}},_=function(n,e,r,a){var i=this;this.get=function(n){return t.findEnv(i.env,i.base,n)[0]},this.has=function(n){return t.findEnv(i.env,i.base,n)[1]},this.set=function(n,e){return t.setEnv(i.env,n,e)},this.dynamicGet=function(n){return t.findEnv(i.dynamicEnv,null,n)[0]},this.dynamicHas=function(n){return t.findEnv(i.dynamicEnv,null,n)[1]},this.dynamicSet=function(n,e){return t.setEnv(h(i.dynamicEnv),n,e)},this.dynamicSetLocal=function(n,e){return t.setEnv(i.dynamicEnv,n,e)},this.callerGet=function(n){return t.findEnv(i.callerEnv,i.base,n)[0]},this.callerHas=function(n){return t.findEnv(i.callerEnv,i.base,n)[1]},this.env=n,this.dynamicEnv=e,this.callerEnv=r,this.base=a};t.EnvWrapper=_;var w=function(){function n(n,e,r){var a=this;this.status="pending",this.promise=new Promise((function(n,e){a.resolve=n,a.reject=e})),this.interpreter=n,this.coninuation=r,t.isPromiseLike(e)?e.then((function(n){a.resolvedValue=n,a.status="fulfilled",a.resolve()}),(function(n){a.rejectedReason=n,a.status="rejected",a.reject(n)})):(this.resolvedValue=e,this.status="fulfilled",this.resolve())}return n.prototype.isFulfilled=function(){return"fulfilled"===this.status},n.prototype.isRejected=function(){return"rejected"===this.status},n.prototype.isPending=function(){return"pending"===this.status},n.prototype.reason=function(){if(!this.isRejected())throw new Error("The promise is not rejected yet.");return this.rejectedReason},n.prototype.resume=function(){if(!this.isFulfilled())throw new Error("The promise is not fulfilled yet.");return this.interpreter.resume(this.coninuation,this.resolvedValue)},n.prototype.then=function(n,e){return this.promise.then(n,e)},n.prototype.catch=function(n){return this.promise.catch(n)},n}();t.ContinuablePromise=w,t.TheGlobal=globalThis||window||e||e;var x=Object.assign(Object.create(t.TheGlobal),{"=":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]===n[1]},"<":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])<Number(n[1])},"+":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])+Number(n[1])},"-":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])-Number(n[1])},"*":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])*Number(n[1])},"/":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])/Number(n[1])},isa:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]instanceof n[1]},type:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return typeof n[0]},new:function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((n=e[0]).bind.apply(n,e))},del:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return delete n[0][n[1]]},throw:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];throw n[0]},read:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return JSON.parse(n[0])},js:eval});t.default=y}))),o=r(t((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),n.__exportStar(i,r)})));export default o;
