/*!
  ContinuableMinimalLisp.js v0.4.4
  https://github.com/trb-a/continuable-minimal-lisp
  Released under the MIT License.
  Note: Language specification's license is unconfirmed.
*/
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function n(){for(var n=0,e=0,r=arguments.length;e<r;e++)n+=arguments[e].length;var t=Array(n),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)t[a]=i[o];return t}var e=["do",["def","new",["fn",["a","&","b"],[".","Reflect",["`","construct"],"a","b"]]],["def","del",["fn",["a","b"],[".","Reflect",["`","deleteProperty"],"a","b"]]],["def","list",["fn",["&","a"],"a"]],["def",">=",["fn",["a","b"],["if",["<","a","b"],!1,!0]]],["def",">",["fn",["a","b"],["if",[">=","a","b"],["if",["=","a","b"],!1,!0],!1]]],["def","<=",["fn",["a","b"],["if",[">","a","b"],!1,!0]]],["def","classOf",["fn",["a"],[".",[".-",[".-","Object",["`","prototype"]],["`","toString"]],["`","call"],"a"]]],["def","not",["fn",["a"],["if","a",!1,!0]]],["def","null?",["fn",["a"],["=",null,"a"]]],["def","true?",["fn",["a"],["=",!0,"a"]]],["def","false?",["fn",["a"],["=",!1,"a"]]],["def","string?",["fn",["a"],["if",["=","a",null],!1,["=",["`","String"],[".-",[".-","a",["`","constructor"]],["`","name"]]]]]],["def","pr-str",["fn",["&","a"],[".",["map",[".-","JSON",["`","stringify"]],"a"],["`","join"],["`"," "]]]],["def","str",["fn",["&","a"],[".",["map",["fn",["x"],["if",["string?","x"],"x",[".","JSON",["`","stringify"],"x"]]],"a"],["`","join"],["`",""]]]],["def","prn",["fn",["&","a"],["do",[".","console",["`","log"],[".",["map",[".-","JSON",["`","stringify"]],"a"],["`","join"],["`"," "]]],null]]],["def","println",["fn",["&","a"],["do",[".","console",["`","log"],[".",["map",["fn",["x"],["if",["string?","x"],"x",[".","JSON",["`","stringify"],"x"]]],"a"],["`","join"],["`"," "]]],null]]],["def","list?",["fn",["a"],[".","Array",["`","isArray"],"a"]]],["def","contains?",["fn",["a","b"],[".","a",["`","hasOwnProperty"],"b"]]],["def","get",["fn",["a","b"],["if",["contains?","a","b"],[".-","a","b"],null]]],["def","set",["fn",["a","b","c"],["do",[".-","a","b","c"],"a"]]],["def","keys",["fn",["a"],[".","Object",["`","keys"],"a"]]],["def","vals",["fn",["a"],[".","Object",["`","values"],"a"]]],["def","cons",["fn",["a","b"],[".",["`",[]],["`","concat"],["list","a"],"b"]]],["def","concat",["fn",["&","a"],[".",[".-",["list"],["`","concat"]],["`","apply"],["list"],"a"]]],["def","nth","get"],["def","first",["fn",["a"],["if",[">",[".-","a",["`","length"]],0],["nth","a",0],null]]],["def","last",["fn",["a"],["nth","a",["-",[".-","a",["`","length"]],1]]]],["def","count",["fn",["a"],[".-","a",["`","length"]]]],["def","empty?",["fn",["a"],["if",["list?","a"],["=",0,[".-","a",["`","length"]]],["=","a",null]]]],["def","slice",["fn",["a","b","&","end"],[".","a",["`","slice"],"b",["if",[">",[".-","end",["`","length"]],0],["get","end",0],[".-","a",["`","length"]]]]]],["def","rest",["fn",["a"],["slice","a",1]]],["def","and",["~",["fn",["&","xs"],["if",["empty?","xs"],!0,["if",["=",1,[".-","xs",["`","length"]]],["first","xs"],["list",["`","let"],["list",["`","__and"],["first","xs"]],["list",["`","if"],["`","__and"],["concat",["`",["and"]],["rest","xs"]],["`","__and"]]]]]]]],["def","or",["~",["fn",["&","xs"],["if",["empty?","xs"],null,["if",["=",1,[".-","xs",["`","length"]]],["first","xs"],["list",["`","let"],["list",["`","__or"],["first","xs"]],["list",["`","if"],["`","__or"],["`","__or"],["concat",["`",["or"]],["rest","xs"]]]]]]]]],null],r="Continuable-miniMAL-Lisp",t="0.4.4",a=function(n,e){if(void 0===e&&(e=new Map),e.has(n))return e.get(n);if("object"==typeof n&&null!==n&&n.constructor===Object)return Object.keys(n).reduce((function(r,t){return r[t]=a(n[t],e),r}),{});if(n instanceof Array){var r=e.set(n,[]).get(n);return r.push.apply(r,n.map((function(n){return a(n,e)}))),r}return n},i=function(n){throw n},o=function(n){return!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then},u=function(n){return"string"==typeof n||i(n+" is not a symbol")},f=function(n){return"string"==typeof n||"symbol"==typeof n||"number"==typeof n||i("String(x) is not a property index")},l=function(n,e){return"object"==typeof e&&null!==e&&"string"==typeof e.bor&&e.constructor===Object&&1===Object.keys(e).length&&e.bor in n},s=function(n){return n instanceof Array},c=function(n){return s(n)||i(n+" is not an array")},d=function(n){return n instanceof Array&&"object"==typeof n[0]&&null!==n[0]&&(n[1]instanceof Array||null===n[1])},v=function(n){return n instanceof Array&&"=>"===n[0]&&4===n.length&&d(n[3])&&n[1]instanceof Array&&n[1].every((function(n){return"string"==typeof n}))},p=function(n){return n instanceof Array&&"~"===n[0]&&2===n.length&&y(n[1])},h=function(n){return n instanceof Array&&"~~"===n[0]&&2===n.length&&y(n[1])},g=function(n){return"function"==typeof n},y=function(n){return v(n)||g(n)||x(n)||p(n)||h(n)},b=function(n){return y(n)||i(n+" is not a applicable")},m=function(n){return h(n)||i(n+" is not a half macro")},x=function(n){return"object"==typeof n&&null!==n&&function(n){return"object"==typeof n&&null!==n&&n.parent instanceof Array&&"number"==typeof n.index&&d(n.env)&&(null===n.flag||"string"==typeof n.flag)&&"object"==typeof n.handler}(n.current)&&n.stack instanceof Array&&"string"==typeof n.version&&n.version.replace(/\.[^.]+$/,"")==="0.4.4".replace(/\.[^.]+$/,"")},w=function(n){return x(n)||i(n+" is not a continuation")},E=function(n){return n instanceof Array&&"try"===n[0]&&n[2]instanceof Array&&"string"==typeof n[2][1]&&n[2].length>=3||i(n+" is not a try form or malformed")},O=function(n,e,r,t){void 0===t&&(t=!0);for(var a={},i=0;i<e.length;i++){if(t&&"&"===e[i]){a[""+e[i+1]]=r.slice(i);break}a[""+e[i]]=r[i]}return[a,n]},j=function(n,e,r){return n[0][""+e]=r},A=function(n,e,r){for(var t=n;t;t=t[1]){if(t[0].hasOwnProperty(r))return[t[0][r],!0,!1];if(!t[1]&&e&&r in e&&null!==e[r]&&("object"==typeof e[r]||"function"==typeof e[r]))return[{bor:r},!0,!0]}return[null,!1,!1]},S=function(n){return n[1]?S(n[1]):n},R=function(r){var t,o=this;if(this.stackMax=1/0,this.base=P,this.env=[{},null],this.dynamicEnv=[{},null],this.loadCore=!0,this.debugCount=0,this.debugMode=!1,this.debugCore=!1,this.debugMax=1/0,this.debugFilter=function(){return!0},this.debug=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];if(o.debugMode&&o.debugFilter(e)&&(r=r.map((function(n){return n instanceof Array?a(n):n})),console.log.apply(console,n([e],r)),o.debugCount++,o.debugCount>o.debugMax))throw new Error("too many debug message!")},this.evalAST=function(e,r,t){void 0===r&&(r=o.env),void 0===t&&(t=o.dynamicEnv);for(var a=[e],u=[{parent:a,index:0,env:r,dynamicEnv:t,flag:null,handler:null}],f=function(n){return u.length>=o.stackMax?i("Stack overflow"):(u.push(n),n)},l=function(){o.debug("Current eval-stack length, eval-stack: ",u.length,u);var e=u.pop(),r=e.parent,t=e.index,a=e.env,l=e.dynamicEnv,c=e.flag,d=e.handler,v=r[t];o.debug("Next evaluating AST node, env, dynamicEnv, flag: ",v,a,l,c);try{if("string"==typeof v){var g=A(a,o.base,v),y=g[0],b=g[1];r[t]=b?y:i(v+" not found")}else if(s(v)){var m="string"==typeof v[0]?o.derefBOR(A(a,o.base,v[0])[0]):null,w=(p(m)?C:h(m)||h(o.derefBOR(v[0]))&&c?k:"string"==typeof v[0]&&M.hasOwnProperty(v[0])?M[v[0]]:x(v[0])||x(m)?B:N)({node:v,env:a,base:o.base,dynamicEnv:l,flag:c,handler:d,cont:{current:e,stack:u,lang:"Continuable-miniMAL-Lisp",version:"0.4.4",info:null},interpreter:o}),O=w.ret,S=w.subevals,R=w.reevals;null==R||R.reverse().forEach((function(n){var e,i,o,u,s,c;return f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(i=n.index)&&void 0!==i?i:t,env:null!==(o=n.env)&&void 0!==o?o:a,dynamicEnv:null!==(u=n.dynamicEnv)&&void 0!==u?u:l,flag:null!==(s=n.flag)&&void 0!==s?s:null,handler:null!==(c=n.handler)&&void 0!==c?c:d})})),null==S||S.reverse().forEach((function(n){var e,i,o,u,s,c;return n&&f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(i=n.index)&&void 0!==i?i:t,env:null!==(o=n.env)&&void 0!==o?o:a,dynamicEnv:null!==(u=n.dynamicEnv)&&void 0!==u?u:l,flag:null!==(s=n.flag)&&void 0!==s?s:null,handler:null!==(c=n.handler)&&void 0!==c?c:d})})),r[t]=O}}catch(e){if(x(e))throw o.debug("Suspend. Continuation: ",e),e;if(e instanceof J)throw o.debug("Suspend. ContinuablePomise: ",e),e;if(o.debug("Caught an exception. Exception: ",e),!d)throw e;var _=d.parent[d.index];E(_);var T=_[2][1];j(d.env,T,e),u.splice.apply(u,n([0,u.length],u.filter((function(n){return n.handler!==d})))),f(d)}finally{o.debug("Evaluation Done. Node, env, dynamicEnv: ",r[t],a,l)}};u.length;)l();return o.debug("Evaluatin finished. Result: ",a[0]),a[0]},this.eval=function(n){return o.evalAST(n)},this.rep=function(n){try{return JSON.stringify(o.eval(JSON.parse(n)))}catch(n){if(n instanceof TypeError&&n.message.match(/(circular|cyclic)/i))return;throw n}},this.resume=function(n,e){return o.evalAST(["resume",n,e])},this.evalInBase=function(n){o.evalAST(n,[o.base,null])},this.derefBOR=function(n){return l(o.base,n)?o.base[n.bor]:n},this.wrapLambda=function(e){return v(e)?function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return o.evalAST(n([["`",e]],r))}:e},this.evalAsync=function(n){return new Promise((function(e,r){var t=function(n){try{e(n instanceof J?n.resume():o.eval(n))}catch(n){n instanceof J?n.then((function(){return t(n)}),(function(n){return r(n)})):r(n)}};t(n)}))},"object"==typeof(t=r)&&null!==t&&Object.keys(t).filter((function(n){return void 0===t[n]})).forEach((function(n){return delete t[n]})),Object.assign(this,r),this.loadCore){var u=this.debugMode;this.debugMode=this.debugCore,this.evalInBase(e),this.debugMode=u}},N=function(e){var r=e.node,t=e.env,a=e.dynamicEnv,i=e.base,o=e.flag,u=e.interpreter,f=u.derefBOR(r[0]);if(!o&&!y(f)){var l=n(r);return{ret:l,reevals:[{flag:"!"}],subevals:l.map((function(n,e){return{parent:l,index:e,env:t}}))}}var s=r.slice(1);if(g(f))try{return{ret:f.apply(void 0,s.map((function(n){return u.wrapLambda(u.derefBOR(n))})))}}catch(p){if(x(p))throw"Javascript function can not throw any continuation.";throw p}else{if(!v(f))throw String(f)+" is not applicable";var c=f[1],d=f[2],p=f[3];if("function"!=typeof d)return{ret:d,reevals:[{env:O(p,c,s)}]};try{return{ret:d(new _(O(p,c,s),a,t,i),u)}}catch(p){if(x(p))throw"Javascript function can not throw any continuation.";throw p}}},C=function(e){var r=e.node,t=e.env,a=e.base,o=e.interpreter;u(r[0]);var f,l=o.derefBOR(A(t,a,r[0])[0]);return p(f=l)||i(f+" is not a macro"),{ret:n([l[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}},k=function(e){var r=e.node,t=e.env,a=e.base,i=e.flag,o=e.interpreter;if(i){f=o.derefBOR(r[0]);return m(f),{ret:n([f[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}}u(r[0]);var f=o.derefBOR(A(t,a,r[0])[0]);m(f);var l=n(r);return{ret:l,subevals:l.map((function(n,e){return{parent:l,index:e}})),reevals:[{flag:"!"}]}},B=function(e){var r,t=e.node,a=e.flag,i=e.cont,o=t[0];if(a||y(o)){var u=t.slice(1);w(o);var f=o.current,l=f.parent;l[f.index]=null!==(r=u[0])&&void 0!==r?r:null;var s=o.stack.length>0?o.stack[0].parent:l;if(1!==s.length)throw"Illeal root of continuation";var c=o.stack.map((function(n){return n.parent===s&&(n.parent=i.current.parent,n.index=i.current.index),n}));return{ret:s[0],subevals:c.reverse()}}var d=n(t);return{ret:d,reevals:[{flag:"!"}],subevals:d.map((function(n,e){return{parent:d,index:e}}))}},M={"`":function(n){return{ret:n.node[1]}},eval:function(e){var r=e.node;if(e.flag)return{ret:r[1],reevals:[{flag:null}]};var t=n(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},def:function(e){var r=e.node,t=e.env;if(e.flag){var a=r[1],i=r[2],o=void 0===i?null:i;return u(a),{ret:j(t,a,o)}}var f=n(r);return{ret:f,reevals:[{flag:"!"}],subevals:[{parent:f,index:2}]}},defdynamic:function(e){var r=e.node,t=e.dynamicEnv;if(e.flag){var a=r[1],i=r[2],o=void 0===i?null:i;return u(a),j(S(t),a,o),{ret:o}}var f=n(r);return{ret:f,reevals:[{flag:"!"}],subevals:[{parent:f,index:2}]}},"~":function(e){var r=e.node,t=e.flag,a=n(r);return t?(b(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},"~~":function(e){var r=e.node,t=e.flag,a=n(r);return t?(b(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},".-":function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read/set property of null or undefined.";var o=r.map((function(n){return a.derefBOR(n)})),u=o[2],l=o[3];return f(u),{ret:3===r.length?i[u]:i[u]=l}}var s=n(r);return{ret:s,reevals:[{flag:"!"}],subevals:s.map((function(n,e){return e>=1&&{parent:s,index:e}}))}},".":function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(!t){var i=n(r);return{ret:i,reevals:[{flag:"!"}],subevals:i.map((function(n,e){return e>=1&&{parent:i,index:e}}))}}var o=a.derefBOR(r[1]);if(null==o)throw"Can't call method of null or undefined.";var u=r[2],l=r.slice(3);if(f(u),"function"!=typeof o[u])return b(o[u]),{ret:n([o[u]],l),reevals:[{flag:"!"}]};try{return{ret:o[u].apply(o,l.map((function(n){return a.wrapLambda(a.derefBOR(n))})))}}catch(n){if(x(n))throw"Javascript methods can not throw any continuation.";throw n}},oget:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read property of null or undefined.";var o=r[2];return f(o),{ret:i[o]}}var u=n(r);return{ret:u,reevals:[{flag:"!"}],subevals:u.map((function(n,e){return e>=1&&{parent:u,index:e}}))}},oset:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't set property of null or undefined.";var o=r[2],u=r[3];return f(o),{ret:i[o]=u}}var l=n(r);return{ret:l,reevals:[{flag:"!"}],subevals:l.map((function(n,e){return e>=1&&{parent:l,index:e}}))}},try:function(e){var r=e.node,t=e.env,a=e.dynamicEnv,i=e.flag,o=e.cont,u=e.handler;if(E(r),i){if("!"===i)return{ret:r[1]};if("!!"===i)return{ret:r[2][2],reevals:[{}]};throw"Illegal status for try-catch."}var f={parent:o.current.parent,index:o.current.index,env:O(t,[],[]),dynamicEnv:a,flag:"!!",handler:u},l=n(r);return{ret:l,reevals:[{flag:"!",handler:f}],subevals:[{parent:l,index:1,handler:f}]}},fn:function(n){var e,r=n.node,t=n.env;return(e=r)instanceof Array&&"fn"===e[0]&&3===e.length&&e[1]instanceof Array&&e[1].every((function(n){return"string"==typeof n}))||i(e+" is not a fn form or malformed"),{ret:["=>",r[1],r[2],t]}},map:function(e){var r=e.node;if(e.flag){var t=r[1],a=r[2];c(a);var i=a.map((function(n,e){return[t,a[e]]}));return{ret:i,subevals:i.map((function(n,e){return{parent:i,index:e,flag:"!"}}))}}var o=n(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},apply:function(e){var r=e.node;if(e.flag){var t=r[1],a=r.slice(2),i=a.pop();return c(i),a.push.apply(a,i),{ret:n([t],a),reevals:[{flag:"!"}]}}var o=n(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},let:function(e){var r,t=e.node,a=e.env;(r=t)instanceof Array&&"let"===r[0]&&r[1]instanceof Array&&r.length>=3||i(r+" is not a let form or malformed");var o=t[1],u=t[2];return o.length%2==1&&o.push(null),{ret:n(["do"],o.reduce((function(n,e,r){return r%2?n:n.concat([[o[r],o[r+1]]])}),[]).map((function(n){return["def",n[0],n[1]]})),[u]),reevals:[{env:O(a,[],[])}]}},"dynamic-let":function(e){var r,t=e.node,a=e.dynamicEnv,o=e.flag;if((r=t)instanceof Array&&"dynamic-let"===r[0]&&r[1]instanceof Array&&r.length>=3||i(r+" is not a let form or malformed"),o){var u=t[1];d=t[2];u.length%2==1&&u.push(null);var f=u.reduce((function(n,e,r){return r%2?n:n.concat([[u[r],u[r+1]]])}),[]),l=O(a,[],[]);return f.forEach((function(n){var e=n[0],r=n[1];return j(l,String(e),r)})),{ret:d,reevals:[{dynamicEnv:l}]}}var s=t[0],c=t[1],d=t[2],v=n(c);return{ret:[s,v,d],subevals:v.map((function(n,e){return e})).filter((function(n){return n%2==1})).map((function(n){return{parent:v,index:n}})),reevals:[{flag:"!"}]}},do:function(n){var e=n.node.slice(1),r=e.slice(-1)[0];return{ret:void 0===r?null:r,reevals:[{flag:null}],subevals:e.slice(0,-1).map((function(n){return{parent:[n],index:0}}))}},if:function(e){var r=e.node;if(e.flag)return{ret:r[1]?r[2]:r[3],reevals:[{flag:null}]};var t=n(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},suspend:function(e){var r,t=e.node,a=e.flag,i=e.cont;if(a){var o=t.slice(1);throw i.info=null!==(r=o[0])&&void 0!==r?r:null,i}var u=n(t);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}},resume:function(e){var r=e.node,t=(e.flag,r[1]),a=r.slice(2);return w(t),{ret:n([t],a),reevals:[{flag:"!"}]}},dynamic:function(n){var e=n.node,r=n.dynamicEnv,t=e[1];u(t);var a=A(r,null,t),o=a[0];return{ret:a[1]?o:i("dynamic variable "+t+" not found")}},await:function(e){var r=e.node,t=e.flag,a=e.cont,i=e.interpreter;if(t){var o=r.slice(1);throw new J(i,0===o.length?null:1===o.length?o[0]:Promise.all(o),a)}var u=n(r);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}}},_=function(n,e,r,t){var a=this;this.get=function(n){return A(a.env,a.base,n)[0]},this.has=function(n){return A(a.env,a.base,n)[1]},this.set=function(n,e){return j(a.env,n,e)},this.dynamicGet=function(n){return A(a.dynamicEnv,null,n)[0]},this.dynamicHas=function(n){return A(a.dynamicEnv,null,n)[1]},this.dynamicSet=function(n,e){return j(S(a.dynamicEnv),n,e)},this.dynamicSetLocal=function(n,e){return j(a.dynamicEnv,n,e)},this.callerGet=function(n){return A(a.callerEnv,a.base,n)[0]},this.callerHas=function(n){return A(a.callerEnv,a.base,n)[1]},this.env=n,this.dynamicEnv=e,this.callerEnv=r,this.base=t},J=function(){function n(n,e,r){var t=this;this.status="pending",this.promise=new Promise((function(n,e){t.resolve=n,t.reject=e})),this.interpreter=n,this.coninuation=r,o(e)?e.then((function(n){t.resolvedValue=n,t.status="fulfilled",t.resolve()}),(function(n){t.rejectedReason=n,t.status="rejected",t.reject(n)})):(this.resolvedValue=e,this.status="fulfilled",this.resolve())}return n.prototype.isFulfilled=function(){return"fulfilled"===this.status},n.prototype.isRejected=function(){return"rejected"===this.status},n.prototype.isPending=function(){return"pending"===this.status},n.prototype.reason=function(){if(!this.isRejected())throw new Error("The promise is not rejected yet.");return this.rejectedReason},n.prototype.resume=function(){if(!this.isFulfilled())throw new Error("The promise is not fulfilled yet.");return this.interpreter.resume(this.coninuation,this.resolvedValue)},n.prototype.then=function(n,e){return this.promise.then(n,e)},n.prototype.catch=function(n){return this.promise.catch(n)},n}(),T=globalThis||window||global||this,P=Object.assign(Object.create(T),{"=":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]===n[1]},"<":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])<Number(n[1])},"+":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])+Number(n[1])},"-":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])-Number(n[1])},"*":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])*Number(n[1])},"/":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])/Number(n[1])},isa:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]instanceof n[1]},type:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return typeof n[0]},new:function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((n=e[0]).bind.apply(n,e))},del:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return delete n[0][n[1]]},throw:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];throw n[0]},read:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return JSON.parse(n[0])},js:eval});export{J as ContinuablePromise,_ as EnvWrapper,R as Interpreter,r as LANGUAGE,T as TheGlobal,t as VERSION,a as cloneAST,A as findEnv,y as isApplicable,l as isBOR,x as isContinuation,d as isEnv,h as isHalfMacro,v as isLambda,p as isMacro,o as isPromiseLike,O as newEnv,j as setEnv};
