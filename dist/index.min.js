/*!
  ContinuableMinimalLisp.js v0.4.4
  https://github.com/trb-a/continuable-minimal-lisp
  Released under the MIT License.
  Note: Language specification's license is unconfirmed.
*/
"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function n(){for(var n=0,e=0,r=arguments.length;e<r;e++)n+=arguments[e].length;var t=Array(n),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)t[a]=i[o];return t}Object.defineProperty(exports,"__esModule",{value:!0});var e=["do",["def","new",["fn",["a","&","b"],[".","Reflect",["`","construct"],"a","b"]]],["def","del",["fn",["a","b"],[".","Reflect",["`","deleteProperty"],"a","b"]]],["def","list",["fn",["&","a"],"a"]],["def",">=",["fn",["a","b"],["if",["<","a","b"],!1,!0]]],["def",">",["fn",["a","b"],["if",[">=","a","b"],["if",["=","a","b"],!1,!0],!1]]],["def","<=",["fn",["a","b"],["if",[">","a","b"],!1,!0]]],["def","classOf",["fn",["a"],[".",[".-",[".-","Object",["`","prototype"]],["`","toString"]],["`","call"],"a"]]],["def","not",["fn",["a"],["if","a",!1,!0]]],["def","null?",["fn",["a"],["=",null,"a"]]],["def","true?",["fn",["a"],["=",!0,"a"]]],["def","false?",["fn",["a"],["=",!1,"a"]]],["def","string?",["fn",["a"],["if",["=","a",null],!1,["=",["`","String"],[".-",[".-","a",["`","constructor"]],["`","name"]]]]]],["def","pr-str",["fn",["&","a"],[".",["map",[".-","JSON",["`","stringify"]],"a"],["`","join"],["`"," "]]]],["def","str",["fn",["&","a"],[".",["map",["fn",["x"],["if",["string?","x"],"x",[".","JSON",["`","stringify"],"x"]]],"a"],["`","join"],["`",""]]]],["def","prn",["fn",["&","a"],["do",[".","console",["`","log"],[".",["map",[".-","JSON",["`","stringify"]],"a"],["`","join"],["`"," "]]],null]]],["def","println",["fn",["&","a"],["do",[".","console",["`","log"],[".",["map",["fn",["x"],["if",["string?","x"],"x",[".","JSON",["`","stringify"],"x"]]],"a"],["`","join"],["`"," "]]],null]]],["def","list?",["fn",["a"],[".","Array",["`","isArray"],"a"]]],["def","contains?",["fn",["a","b"],[".","a",["`","hasOwnProperty"],"b"]]],["def","get",["fn",["a","b"],["if",["contains?","a","b"],[".-","a","b"],null]]],["def","set",["fn",["a","b","c"],["do",[".-","a","b","c"],"a"]]],["def","keys",["fn",["a"],[".","Object",["`","keys"],"a"]]],["def","vals",["fn",["a"],[".","Object",["`","values"],"a"]]],["def","cons",["fn",["a","b"],[".",["`",[]],["`","concat"],["list","a"],"b"]]],["def","concat",["fn",["&","a"],[".",[".-",["list"],["`","concat"]],["`","apply"],["list"],"a"]]],["def","nth","get"],["def","first",["fn",["a"],["if",[">",[".-","a",["`","length"]],0],["nth","a",0],null]]],["def","last",["fn",["a"],["nth","a",["-",[".-","a",["`","length"]],1]]]],["def","count",["fn",["a"],[".-","a",["`","length"]]]],["def","empty?",["fn",["a"],["if",["list?","a"],["=",0,[".-","a",["`","length"]]],["=","a",null]]]],["def","slice",["fn",["a","b","&","end"],[".","a",["`","slice"],"b",["if",[">",[".-","end",["`","length"]],0],["get","end",0],[".-","a",["`","length"]]]]]],["def","rest",["fn",["a"],["slice","a",1]]],["def","and",["~",["fn",["&","xs"],["if",["empty?","xs"],!0,["if",["=",1,[".-","xs",["`","length"]]],["first","xs"],["list",["`","let"],["list",["`","__and"],["first","xs"]],["list",["`","if"],["`","__and"],["concat",["`",["and"]],["rest","xs"]],["`","__and"]]]]]]]],["def","or",["~",["fn",["&","xs"],["if",["empty?","xs"],null,["if",["=",1,[".-","xs",["`","length"]]],["first","xs"],["list",["`","let"],["list",["`","__or"],["first","xs"]],["list",["`","if"],["`","__or"],["`","__or"],["concat",["`",["or"]],["rest","xs"]]]]]]]]],null],r=function(n,e){if(void 0===e&&(e=new Map),e.has(n))return e.get(n);if("object"==typeof n&&null!==n&&n.constructor===Object)return Object.keys(n).reduce((function(t,a){return t[a]=r(n[a],e),t}),{});if(n instanceof Array){var t=e.set(n,[]).get(n);return t.push.apply(t,n.map((function(n){return r(n,e)}))),t}return n},t=function(n){throw n},a=function(n){return!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then},i=function(n){return"string"==typeof n||t(n+" is not a symbol")},o=function(n){return"string"==typeof n||"symbol"==typeof n||"number"==typeof n||t("String(x) is not a property index")},u=function(n,e){return"object"==typeof e&&null!==e&&"string"==typeof e.bor&&e.constructor===Object&&1===Object.keys(e).length&&e.bor in n},l=function(n){return n instanceof Array},f=function(n){return l(n)||t(n+" is not an array")},s=function(n){return n instanceof Array&&"object"==typeof n[0]&&null!==n[0]&&(n[1]instanceof Array||null===n[1])},c=function(n){return n instanceof Array&&"=>"===n[0]&&4===n.length&&s(n[3])&&n[1]instanceof Array&&n[1].every((function(n){return"string"==typeof n}))},d=function(n){return n instanceof Array&&"~"===n[0]&&2===n.length&&h(n[1])},v=function(n){return n instanceof Array&&"~~"===n[0]&&2===n.length&&h(n[1])},p=function(n){return"function"==typeof n},h=function(n){return c(n)||p(n)||b(n)||d(n)||v(n)},g=function(n){return h(n)||t(n+" is not a applicable")},y=function(n){return v(n)||t(n+" is not a half macro")},b=function(n){return"object"==typeof n&&null!==n&&function(n){return"object"==typeof n&&null!==n&&n.parent instanceof Array&&"number"==typeof n.index&&s(n.env)&&(null===n.flag||"string"==typeof n.flag)&&"object"==typeof n.handler}(n.current)&&n.stack instanceof Array&&"string"==typeof n.version&&n.version.replace(/\.[^.]+$/,"")==="0.4.4".replace(/\.[^.]+$/,"")},m=function(n){return b(n)||t(n+" is not a continuation")},x=function(n){return n instanceof Array&&"try"===n[0]&&n[2]instanceof Array&&"string"==typeof n[2][1]&&n[2].length>=3||t(n+" is not a try form or malformed")},w=function(n,e,r,t){void 0===t&&(t=!0);for(var a={},i=0;i<e.length;i++){if(t&&"&"===e[i]){a[""+e[i+1]]=r.slice(i);break}a[""+e[i]]=r[i]}return[a,n]},E=function(n,e,r){return n[0][""+e]=r},O=function(n,e,r){for(var t=n;t;t=t[1]){if(t[0].hasOwnProperty(r))return[t[0][r],!0,!1];if(!t[1]&&e&&r in e&&null!==e[r]&&("object"==typeof e[r]||"function"==typeof e[r]))return[{bor:r},!0,!0]}return[null,!1,!1]},j=function(n){return n[1]?j(n[1]):n},A=function(a){var i,o=this;if(this.stackMax=1/0,this.base=P,this.env=[{},null],this.dynamicEnv=[{},null],this.loadCore=!0,this.debugCount=0,this.debugMode=!1,this.debugCore=!1,this.debugMax=1/0,this.debugFilter=function(){return!0},this.debug=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];if(o.debugMode&&o.debugFilter(e)&&(t=t.map((function(n){return n instanceof Array?r(n):n})),console.log.apply(console,n([e],t)),o.debugCount++,o.debugCount>o.debugMax))throw new Error("too many debug message!")},this.evalAST=function(e,r,a){void 0===r&&(r=o.env),void 0===a&&(a=o.dynamicEnv);for(var i=[e],u=[{parent:i,index:0,env:r,dynamicEnv:a,flag:null,handler:null}],f=function(n){return u.length>=o.stackMax?t("Stack overflow"):(u.push(n),n)},s=function(){o.debug("Current eval-stack length, eval-stack: ",u.length,u);var e=u.pop(),r=e.parent,a=e.index,i=e.env,s=e.dynamicEnv,c=e.flag,p=e.handler,h=r[a];o.debug("Next evaluating AST node, env, dynamicEnv, flag: ",h,i,s,c);try{if("string"==typeof h){var g=O(i,o.base,h),y=g[0],m=g[1];r[a]=m?y:t(h+" not found")}else if(l(h)){var w="string"==typeof h[0]?o.derefBOR(O(i,o.base,h[0])[0]):null,j=(d(w)?R:v(w)||v(o.derefBOR(h[0]))&&c?N:"string"==typeof h[0]&&k.hasOwnProperty(h[0])?k[h[0]]:b(h[0])||b(w)?C:S)({node:h,env:i,base:o.base,dynamicEnv:s,flag:c,handler:p,cont:{current:e,stack:u,lang:"Continuable-miniMAL-Lisp",version:"0.4.4",info:null},interpreter:o}),A=j.ret,B=j.subevals,_=j.reevals;null==_||_.reverse().forEach((function(n){var e,t,o,u,l,c;return f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(t=n.index)&&void 0!==t?t:a,env:null!==(o=n.env)&&void 0!==o?o:i,dynamicEnv:null!==(u=n.dynamicEnv)&&void 0!==u?u:s,flag:null!==(l=n.flag)&&void 0!==l?l:null,handler:null!==(c=n.handler)&&void 0!==c?c:p})})),null==B||B.reverse().forEach((function(n){var e,t,o,u,l,c;return n&&f({parent:null!==(e=n.parent)&&void 0!==e?e:r,index:null!==(t=n.index)&&void 0!==t?t:a,env:null!==(o=n.env)&&void 0!==o?o:i,dynamicEnv:null!==(u=n.dynamicEnv)&&void 0!==u?u:s,flag:null!==(l=n.flag)&&void 0!==l?l:null,handler:null!==(c=n.handler)&&void 0!==c?c:p})})),r[a]=A}}catch(e){if(b(e))throw o.debug("Suspend. Continuation: ",e),e;if(e instanceof M)throw o.debug("Suspend. ContinuablePomise: ",e),e;if(o.debug("Caught an exception. Exception: ",e),!p)throw e;var P=p.parent[p.index];x(P);var T=P[2][1];E(p.env,T,e),u.splice.apply(u,n([0,u.length],u.filter((function(n){return n.handler!==p})))),f(p)}finally{o.debug("Evaluation Done. Node, env, dynamicEnv: ",r[a],i,s)}};u.length;)s();return o.debug("Evaluatin finished. Result: ",i[0]),i[0]},this.eval=function(n){return o.evalAST(n)},this.rep=function(n){try{return JSON.stringify(o.eval(JSON.parse(n)))}catch(n){if(n instanceof TypeError&&n.message.match(/(circular|cyclic)/i))return;throw n}},this.resume=function(n,e){return o.evalAST(["resume",n,e])},this.evalInBase=function(n){o.evalAST(n,[o.base,null])},this.derefBOR=function(n){return u(o.base,n)?o.base[n.bor]:n},this.wrapLambda=function(e){return c(e)?function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return o.evalAST(n([["`",e]],r))}:e},this.evalAsync=function(n){return new Promise((function(e,r){var t=function(n){try{e(n instanceof M?n.resume():o.eval(n))}catch(n){n instanceof M?n.then((function(){return t(n)}),(function(n){return r(n)})):r(n)}};t(n)}))},"object"==typeof(i=a)&&null!==i&&Object.keys(i).filter((function(n){return void 0===i[n]})).forEach((function(n){return delete i[n]})),Object.assign(this,a),this.loadCore){var f=this.debugMode;this.debugMode=this.debugCore,this.evalInBase(e),this.debugMode=f}},S=function(e){var r=e.node,t=e.env,a=e.dynamicEnv,i=e.base,o=e.flag,u=e.interpreter,l=u.derefBOR(r[0]);if(!o&&!h(l)){var f=n(r);return{ret:f,reevals:[{flag:"!"}],subevals:f.map((function(n,e){return{parent:f,index:e,env:t}}))}}var s=r.slice(1);if(p(l))try{return{ret:l.apply(void 0,s.map((function(n){return u.wrapLambda(u.derefBOR(n))})))}}catch(g){if(b(g))throw"Javascript function can not throw any continuation.";throw g}else{if(!c(l))throw String(l)+" is not applicable";var d=l[1],v=l[2],g=l[3];if("function"!=typeof v)return{ret:v,reevals:[{env:w(g,d,s)}]};try{return{ret:v(new B(w(g,d,s),a,t,i),u)}}catch(g){if(b(g))throw"Javascript function can not throw any continuation.";throw g}}},R=function(e){var r=e.node,a=e.env,o=e.base,u=e.interpreter;i(r[0]);var l,f=u.derefBOR(O(a,o,r[0])[0]);return d(l=f)||t(l+" is not a macro"),{ret:n([f[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}},N=function(e){var r=e.node,t=e.env,a=e.base,o=e.flag,u=e.interpreter;if(o){l=u.derefBOR(r[0]);return y(l),{ret:n([l[1]],r.slice(1)),reevals:[{flag:"!"},{flag:null}]}}i(r[0]);var l=u.derefBOR(O(t,a,r[0])[0]);y(l);var f=n(r);return{ret:f,subevals:f.map((function(n,e){return{parent:f,index:e}})),reevals:[{flag:"!"}]}},C=function(e){var r,t=e.node,a=e.flag,i=e.cont,o=t[0];if(a||h(o)){var u=t.slice(1);m(o);var l=o.current,f=l.parent;f[l.index]=null!==(r=u[0])&&void 0!==r?r:null;var s=o.stack.length>0?o.stack[0].parent:f;if(1!==s.length)throw"Illeal root of continuation";var c=o.stack.map((function(n){return n.parent===s&&(n.parent=i.current.parent,n.index=i.current.index),n}));return{ret:s[0],subevals:c.reverse()}}var d=n(t);return{ret:d,reevals:[{flag:"!"}],subevals:d.map((function(n,e){return{parent:d,index:e}}))}},k={"`":function(n){return{ret:n.node[1]}},eval:function(e){var r=e.node;if(e.flag)return{ret:r[1],reevals:[{flag:null}]};var t=n(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},def:function(e){var r=e.node,t=e.env;if(e.flag){var a=r[1],o=r[2],u=void 0===o?null:o;return i(a),{ret:E(t,a,u)}}var l=n(r);return{ret:l,reevals:[{flag:"!"}],subevals:[{parent:l,index:2}]}},defdynamic:function(e){var r=e.node,t=e.dynamicEnv;if(e.flag){var a=r[1],o=r[2],u=void 0===o?null:o;return i(a),E(j(t),a,u),{ret:u}}var l=n(r);return{ret:l,reevals:[{flag:"!"}],subevals:[{parent:l,index:2}]}},"~":function(e){var r=e.node,t=e.flag,a=n(r);return t?(g(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},"~~":function(e){var r=e.node,t=e.flag,a=n(r);return t?(g(a[1]),{ret:a}):{ret:a,reevals:[{flag:"!"}],subevals:[{parent:a,index:1}]}},".-":function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read/set property of null or undefined.";var u=r.map((function(n){return a.derefBOR(n)})),l=u[2],f=u[3];return o(l),{ret:3===r.length?i[l]:i[l]=f}}var s=n(r);return{ret:s,reevals:[{flag:"!"}],subevals:s.map((function(n,e){return e>=1&&{parent:s,index:e}}))}},".":function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(!t){var i=n(r);return{ret:i,reevals:[{flag:"!"}],subevals:i.map((function(n,e){return e>=1&&{parent:i,index:e}}))}}var u=a.derefBOR(r[1]);if(null==u)throw"Can't call method of null or undefined.";var l=r[2],f=r.slice(3);if(o(l),"function"!=typeof u[l])return g(u[l]),{ret:n([u[l]],f),reevals:[{flag:"!"}]};try{return{ret:u[l].apply(u,f.map((function(n){return a.wrapLambda(a.derefBOR(n))})))}}catch(n){if(b(n))throw"Javascript methods can not throw any continuation.";throw n}},oget:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't read property of null or undefined.";var u=r[2];return o(u),{ret:i[u]}}var l=n(r);return{ret:l,reevals:[{flag:"!"}],subevals:l.map((function(n,e){return e>=1&&{parent:l,index:e}}))}},oset:function(e){var r=e.node,t=(e.base,e.flag),a=e.interpreter;if(t){var i=a.derefBOR(r[1]);if(null==i)throw"Can't set property of null or undefined.";var u=r[2],l=r[3];return o(u),{ret:i[u]=l}}var f=n(r);return{ret:f,reevals:[{flag:"!"}],subevals:f.map((function(n,e){return e>=1&&{parent:f,index:e}}))}},try:function(e){var r=e.node,t=e.env,a=e.dynamicEnv,i=e.flag,o=e.cont,u=e.handler;if(x(r),i){if("!"===i)return{ret:r[1]};if("!!"===i)return{ret:r[2][2],reevals:[{}]};throw"Illegal status for try-catch."}var l={parent:o.current.parent,index:o.current.index,env:w(t,[],[]),dynamicEnv:a,flag:"!!",handler:u},f=n(r);return{ret:f,reevals:[{flag:"!",handler:l}],subevals:[{parent:f,index:1,handler:l}]}},fn:function(n){var e,r=n.node,a=n.env;return(e=r)instanceof Array&&"fn"===e[0]&&3===e.length&&e[1]instanceof Array&&e[1].every((function(n){return"string"==typeof n}))||t(e+" is not a fn form or malformed"),{ret:["=>",r[1],r[2],a]}},map:function(e){var r=e.node;if(e.flag){var t=r[1],a=r[2];f(a);var i=a.map((function(n,e){return[t,a[e]]}));return{ret:i,subevals:i.map((function(n,e){return{parent:i,index:e,flag:"!"}}))}}var o=n(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},apply:function(e){var r=e.node;if(e.flag){var t=r[1],a=r.slice(2),i=a.pop();return f(i),a.push.apply(a,i),{ret:n([t],a),reevals:[{flag:"!"}]}}var o=n(r);return{ret:o,reevals:[{flag:"!"}],subevals:o.map((function(n,e){return e>=1&&{parent:o,index:e}}))}},let:function(e){var r,a=e.node,i=e.env;(r=a)instanceof Array&&"let"===r[0]&&r[1]instanceof Array&&r.length>=3||t(r+" is not a let form or malformed");var o=a[1],u=a[2];return o.length%2==1&&o.push(null),{ret:n(["do"],o.reduce((function(n,e,r){return r%2?n:n.concat([[o[r],o[r+1]]])}),[]).map((function(n){return["def",n[0],n[1]]})),[u]),reevals:[{env:w(i,[],[])}]}},"dynamic-let":function(e){var r,a=e.node,i=e.dynamicEnv,o=e.flag;if((r=a)instanceof Array&&"dynamic-let"===r[0]&&r[1]instanceof Array&&r.length>=3||t(r+" is not a let form or malformed"),o){var u=a[1];d=a[2];u.length%2==1&&u.push(null);var l=u.reduce((function(n,e,r){return r%2?n:n.concat([[u[r],u[r+1]]])}),[]),f=w(i,[],[]);return l.forEach((function(n){var e=n[0],r=n[1];return E(f,String(e),r)})),{ret:d,reevals:[{dynamicEnv:f}]}}var s=a[0],c=a[1],d=a[2],v=n(c);return{ret:[s,v,d],subevals:v.map((function(n,e){return e})).filter((function(n){return n%2==1})).map((function(n){return{parent:v,index:n}})),reevals:[{flag:"!"}]}},do:function(n){var e=n.node.slice(1),r=e.slice(-1)[0];return{ret:void 0===r?null:r,reevals:[{flag:null}],subevals:e.slice(0,-1).map((function(n){return{parent:[n],index:0}}))}},if:function(e){var r=e.node;if(e.flag)return{ret:r[1]?r[2]:r[3],reevals:[{flag:null}]};var t=n(r);return{ret:t,reevals:[{flag:"!"}],subevals:[{parent:t,index:1}]}},suspend:function(e){var r,t=e.node,a=e.flag,i=e.cont;if(a){var o=t.slice(1);throw i.info=null!==(r=o[0])&&void 0!==r?r:null,i}var u=n(t);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}},resume:function(e){var r=e.node,t=(e.flag,r[1]),a=r.slice(2);return m(t),{ret:n([t],a),reevals:[{flag:"!"}]}},dynamic:function(n){var e=n.node,r=n.dynamicEnv,a=e[1];i(a);var o=O(r,null,a),u=o[0];return{ret:o[1]?u:t("dynamic variable "+a+" not found")}},await:function(e){var r=e.node,t=e.flag,a=e.cont,i=e.interpreter;if(t){var o=r.slice(1);throw new M(i,0===o.length?null:1===o.length?o[0]:Promise.all(o),a)}var u=n(r);return{ret:u,reevals:[{flag:"!"}],subevals:[{parent:u,index:1}]}}},B=function(n,e,r,t){var a=this;this.get=function(n){return O(a.env,a.base,n)[0]},this.has=function(n){return O(a.env,a.base,n)[1]},this.set=function(n,e){return E(a.env,n,e)},this.dynamicGet=function(n){return O(a.dynamicEnv,null,n)[0]},this.dynamicHas=function(n){return O(a.dynamicEnv,null,n)[1]},this.dynamicSet=function(n,e){return E(j(a.dynamicEnv),n,e)},this.dynamicSetLocal=function(n,e){return E(a.dynamicEnv,n,e)},this.callerGet=function(n){return O(a.callerEnv,a.base,n)[0]},this.callerHas=function(n){return O(a.callerEnv,a.base,n)[1]},this.env=n,this.dynamicEnv=e,this.callerEnv=r,this.base=t},M=function(){function n(n,e,r){var t=this;this.status="pending",this.promise=new Promise((function(n,e){t.resolve=n,t.reject=e})),this.interpreter=n,this.coninuation=r,a(e)?e.then((function(n){t.resolvedValue=n,t.status="fulfilled",t.resolve()}),(function(n){t.rejectedReason=n,t.status="rejected",t.reject(n)})):(this.resolvedValue=e,this.status="fulfilled",this.resolve())}return n.prototype.isFulfilled=function(){return"fulfilled"===this.status},n.prototype.isRejected=function(){return"rejected"===this.status},n.prototype.isPending=function(){return"pending"===this.status},n.prototype.reason=function(){if(!this.isRejected())throw new Error("The promise is not rejected yet.");return this.rejectedReason},n.prototype.resume=function(){if(!this.isFulfilled())throw new Error("The promise is not fulfilled yet.");return this.interpreter.resume(this.coninuation,this.resolvedValue)},n.prototype.then=function(n,e){return this.promise.then(n,e)},n.prototype.catch=function(n){return this.promise.catch(n)},n}(),_=globalThis||window||global||this,P=Object.assign(Object.create(_),{"=":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]===n[1]},"<":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])<Number(n[1])},"+":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])+Number(n[1])},"-":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])-Number(n[1])},"*":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])*Number(n[1])},"/":function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Number(n[0])/Number(n[1])},isa:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0]instanceof n[1]},type:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return typeof n[0]},new:function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((n=e[0]).bind.apply(n,e))},del:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return delete n[0][n[1]]},throw:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];throw n[0]},read:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return JSON.parse(n[0])},js:eval});exports.ContinuablePromise=M,exports.EnvWrapper=B,exports.Interpreter=A,exports.LANGUAGE="Continuable-miniMAL-Lisp",exports.TheGlobal=_,exports.VERSION="0.4.4",exports.cloneAST=r,exports.findEnv=O,exports.isApplicable=h,exports.isBOR=u,exports.isContinuation=b,exports.isEnv=s,exports.isHalfMacro=v,exports.isLambda=c,exports.isMacro=d,exports.isPromiseLike=a,exports.newEnv=w,exports.setEnv=E;
